<!DOCTYPE html>
<html>
<head>
  <title>Seki - Player demo</title>
  <meta charset="utf-8">
  <meta name="author" content="Adam Reis">
  <link rel="stylesheet" type="text/css" media="screen" href="css/seki.css">
  <link rel="stylesheet" type="text/css" media="screen" href="css/demo.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon.png">
</head>
<body lang="en">
<div class="main" id="app">
  <div class="left">
    <div id="player">
      <div id="board"></div>
    </div>
  </div>
  <div class="right">
    <h2>Load</h2>
    <button id="loadDemo">Demo</button>
    <button id="loadBlank">Blank</button>
    <button id="loadFile">File</button>

    <h2>Mode</h2>
    <button class="btnSwitchMode icon" mode="static" title="View only">
      <span class="material-symbols-outlined">visibility_lock</span>
    </button>
    <button class="btnSwitchMode icon" mode="replay" title="Replay">
      <span class="material-symbols-outlined">fiber_smart_record</span>
    </button>
    <button class="btnSwitchMode icon" icon mode="edit" title="Edit">
      <span class="material-symbols-outlined">edit</span>
    </button>
    <button class="btnSwitchMode icon" mode="solve" title="Solve">
      <span class="material-symbols-outlined">lightbulb</span>
    </button>

    <div id="editTools">
      <h2>Markup</h2>
      <button class="btnUseEditTool icon" tool="circle" class="icon">
        <span class="material-symbols-outlined">circle</span>
      </button>
      <button class="btnUseEditTool icon" tool="triangle" class="icon">
        <span class="material-symbols-outlined">change_history</span>
      </button>
      <button class="btnUseEditTool icon" tool="square" class="icon">
        <span class="material-symbols-outlined">square</span>
      </button>
      <button class="btnUseEditTool icon" tool="diamond" class="icon">
        <span class="material-symbols-outlined">diamond</span>
      </button>
      <button class="btnUseEditTool icon" tool="mark" class="icon">
        <span class="material-symbols-outlined">close</span>
      </button>
      <br>
      <button class="btnUseEditTool icon" tool="letter" class="icon">
        <span class="material-symbols-outlined">abc</span>
      </button>
      <button class="btnUseEditTool icon" tool="number" class="icon">
        <span class="material-symbols-outlined">123</span>
      </button>
      <button class="btnUseEditTool icon" tool="happy" class="icon">
        <span class="material-symbols-outlined">sentiment_satisfied</span>
      </button>
      <button class="btnUseEditTool icon" tool="sad" class="icon">
        <span class="material-symbols-outlined">sentiment_dissatisfied</span>
      </button>
      <button class="btnUseEditTool icon" tool="clear" class="icon" title="Clear">
        <span class="material-symbols-outlined">ink_eraser</span>
      </button>

      <h2>Setup</h2>
      <button class="btnUseEditTool icon" tool="black" class="icon" title="Black stone">
        <span class="material-symbols-outlined">trip_origin</span>
      </button>
      <button class="btnUseEditTool icon" tool="white" class="icon" title="White stone">
        <span class="material-symbols-outlined">fiber_manual_record</span>
      </button>
      <button class="btnUseEditTool icon" tool="clear" class="icon" title="Clear">
        <span class="material-symbols-outlined">ink_eraser</span>
      </button>
    </div>

    <div id="replayTools">
      <h2>Navigation</h2>

      <button class="btnCommand icon" cmd="goToFirstPosition" title="First position">
        <span class="material-symbols-outlined">line_start_arrow</span>
      </button>
      <button class="btnCommand icon" cmd="goBackNumPositions" title="Skip back 10 positions">
        <span class="material-symbols-outlined">fast_rewind</span>
      </button>
      <button class="btnCommand icon" cmd="goToPreviousPosition" title="Previous position">
        <span class="material-symbols-outlined">skip_previous</span>
      </button>

      <button class="icon" id="startAutoPlay" title="Start auto play">
        <span class="material-symbols-outlined">play_arrow</span>
      </button>
      <button class="icon" id="stopAutoPlay" title="Stop auto play">
        <span class="material-symbols-outlined">stop</span>
      </button>

      <button class="btnCommand icon" cmd="goToNextPosition" title="Next position">
        <span class="material-symbols-outlined">skip_next</span>
      </button>
      <button class="btnCommand icon" cmd="goForwardNumPositions" title="Skip forward 10 positions">
        <span class="material-symbols-outlined">fast_forward</span>
      </button>
      <button class="btnCommand icon" cmd="goToLastPosition" title="Last position">
        <span class="material-symbols-outlined">line_end_arrow</span>
      </button>

      <br>
      <button class="btnCommand icon" cmd="selectPreviousVariation" title="Previous variation">
        <span class="material-symbols-outlined">expand_less</span>
      </button>
      <button class="btnCommand icon" cmd="selectNextVariation" title="Next variation">
        <span class="material-symbols-outlined">expand_more</span>
      </button>
      <button class="btnCommand icon" cmd="goToPreviousFork" title="Previous fork">
        <span class="material-symbols-outlined">fork_left</span>
      </button>
      <button class="btnCommand icon" cmd="goToNextFork" title="Next fork">
        <span class="material-symbols-outlined">fork_right</span>
      </button>
      <button class="btnCommand icon" cmd="goToPreviousComment" title="Previous comment">
        <span class="material-symbols-outlined">comment</span>
      </button>
      <button class="btnCommand icon" cmd="goToNextComment" title="Next comment">
        <span class="material-symbols-outlined">chat</span>
      </button>
    </div>

    <h2>Options</h2>
    <label class="lblToggleConfig" config="swapColors">
      <input type="checkbox"> Swap colors
    </label>
    <label class="lblToggleConfig" config="showCoordinates">
      <input type="checkbox"> Coordinates
    </label>
    <label class="lblToggleConfig" config="showLastMove">
      <input type="checkbox"> Last move
    </label>
    <label class="lblToggleConfig" config="showNextMove">
      <input type="checkbox"> Next move
    </label>
    <label class="lblToggleConfig" config="showAllMoveNumbers">
      <input type="checkbox"> All move numbers
    </label>
    <label class="lblToggleConfig" config="showVariationMoveNumbers">
      <input type="checkbox"> Variation move numbers
    </label>
    <label class="lblToggleConfig" config="showVariations">
      <input type="checkbox"> Variations
    </label>
    <label class="lblToggleConfig" config="rememberVariationPath">
      <input type="checkbox"> Remember path taken
    </label>
    <label class="lblToggleConfig" config="allowMovesInReplayMode">
      <input type="checkbox"> Allow moves in replay mode
    </label>
  </info>
</div>
<script type="module">
import {Board, Player, constants, helpers} from '../../src/index.js'
import {onClick, findByQuery, toggleHidden} from './js/demo.js'

//Audio
import audioMove from './audio/move.wav'
import audioCapture from './audio/capture.wav'

//Test data
import {demo} from './data/jgf.js'

//Get constants
const {playerModes, editTools} = constants.player

//Set debug mode
helpers.util.setDebug(true)

//Find player element and instantiate player
const playerElement = document.getElementById('player')
const player = new Player({
  audio: {
    move: audioMove,
    capture: audioCapture,
  }
})

//Bootstrap player and load JGF file
player.bootstrap(playerElement)
player.load(demo)

//Data loading
onClick('#loadDemo', () => {
  player.load(demo, playerModes.REPLAY)
})
onClick('#loadBlank', () => {
  player.reset(playerModes.REPLAY)
})
onClick('#loadFile', async () => {
  player.openFile(playerModes.REPLAY)
})

//Commands
onClick('.btnCommand', btn => {
  const cmd = btn.getAttribute('cmd')
  player[cmd]()
})

//Config toggles
onClick('.lblToggleConfig', lbl => {
  const key = lbl.getAttribute('config')
  const input = lbl.querySelector('input')
  player.toggleConfig(key, input.checked)
})

//Mode switching
onClick('.btnSwitchMode', btn => {
  const mode = btn.getAttribute('mode')
  player.setMode(mode)
})

//Editing tool selection
onClick('.btnUseEditTool', btn => {
  const tool = btn.getAttribute('tool')
  player.setEditTool(tool)
})

//Auto play
onClick('#startAutoPlay', () => {
  player.startAutoPlay()
  toggleHidden('#startAutoPlay', true)
  toggleHidden('#stopAutoPlay', false)
})
onClick('#stopAutoPlay', () => {
  player.stopAutoPlay()
  toggleHidden('#stopAutoPlay', true)
  toggleHidden('#startAutoPlay', false)
})

//Handler for mode changes
const onModeChange = () => {
  const mode = player.getActiveMode()

  //Toggle mode buttons
  findByQuery('.btnSwitchMode')
    .forEach(btn => btn.disabled = btn.getAttribute('mode') === mode)

  //Toggle tools
  toggleHidden('#replayTools', mode !== playerModes.REPLAY)
  toggleHidden('#editTools', mode !== playerModes.EDIT)
}

//Set checkboxes to initial toggle value
findByQuery('.lblToggleConfig')
  .forEach(lbl => {
    const key = lbl.getAttribute('config')
    const input = lbl.querySelector('input')
    input.checked = player.getConfig(key)
  })

//Event handlers
player.on('modeChange', onModeChange)

//Init
onModeChange()
toggleHidden('#stopAutoPlay', true)
</script>
</body>
</html>
