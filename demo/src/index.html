<!DOCTYPE html>
<html>
<head>
  <title>Seki – Editor Demo</title>
  <meta charset="utf-8">
  <meta name="author" content="Adam Reis">
  <link rel="stylesheet" type="text/css" media="screen" href="css/seki.css">
  <link rel="stylesheet" type="text/css" media="screen" href="css/demo.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon.png">
</head>
<body lang="en">
<div class="background"></div>
<div class="main" id="app">
  <div class="left">

  </div>
  <div class="center">
    <div id="player">
      <div id="board"></div>
    </div>
  </div>
  <div class="right">
    <div class="info">

      <div class="block players">
        <div class="player black">
          <div class="identity">
            <div class="color black"></div>
            <span class="name" id="playerBlackName">Black</span>
          </div>
          <div class="rank" id="playerBlackRank">&nbsp;</div>
          <div class="score">
            <div><span id="blackCaptures">0</span> captures</div>
          </div>
        </div>
        <div class="player white">
          <div class="identity">
            <div class="color white"></div>
            <span class="name" id="playerWhiteName">White</span>
          </div>
          <div class="rank" id="playerWhiteRank">&nbsp;</div>
          <div class="score">
            <div><span id="whiteCaptures">0</span> captures</div>
            <div id="komi"></div>
          </div>
        </div>
      </div>

      <div class="block game hidden" id="gameInfo">
        <div class="row hidden" id="nameRow">
          <div class="label">Name</div>
          <div class="value" id="name"></div>
        </div>
        <div class="row hidden" id="dateRow">
          <div class="label">Date</div>
          <div class="value" id="date"></div>
        </div>
        <div class="row hidden" id="eventRow">
          <div class="label">Event</div>
          <div class="value" id="event"></div>
        </div>
        <div class="row hidden" id="rulesRow">
          <div class="label">Rules</div>
          <div class="value" id="rules"></div>
        </div>
        <div class="row hidden" id="resultRow">
          <div class="label">Result</div>
          <div class="value" id="result"></div>
        </div>
      </div>

      <div class="block buttons utility">
        <button class="btnCommand" cmd="newFile" title="New file [shift-N]">
          <span class="icon material-symbols-outlined">note</span>
        </button>
        <button class="btnCommand" cmd="openFile" title="Open file [shift-O]">
          <span class="icon material-symbols-outlined">upload</span>
        </button>
        <button class="btnCommand" cmd="downloadFile" title="Download file [shift-D]">
          <span class="icon material-symbols-outlined">download</span>
        </button>
        <button id="settings">
          <span class="icon material-symbols-outlined">tune</span>
        </button>
        <div id="settingsDropdown" class="dropdown hidden">
          <div class="settings">
            <label class="toggleConfig" config="showCoordinates">
              <input type="checkbox"> Show coordinates
            </label>
            <label class="toggleConfig" config="showLastMove">
              <input type="checkbox"> Show last move
            </label>
            <label class="toggleConfig" config="showNextMove">
              <input type="checkbox"> Show next move
            </label>
            <label class="toggleConfig" config="showAllMoveNumbers">
              <input type="checkbox"> Show all move numbers
            </label>
            <label class="toggleConfig" config="showVariationMoveNumbers">
              <input type="checkbox"> Show variation move numbers
            </label>
            <label class="toggleConfig" config="showVariations">
              <input type="checkbox"> Show variations
            </label>
            <label class="toggleConfig" config="rememberVariationPath">
              <input type="checkbox"> Remember path taken
            </label>
            <label class="toggleConfig" config="swapColors">
              <input type="checkbox"> Swap colors
            </label>
          </div>
        </div>
      </div>

      <div class="block buttons editing">
        <button id="playMoves" class="btnSwitchMode active" mode="replay" title="Play moves [M]">
          <span class="material-symbols-outlined">fiber_smart_record</span>
        </button>

        <button class="btnTool" tool="stone" title="Place stone [S]">
          <span class="material-symbols-outlined">fiber_manual_record</span>
        </button>
        <button class="btnTool" tool="clear" title="Clear [X]">
          <span class="material-symbols-outlined">ink_eraser</span>
        </button>
        <button class="btnTool" tool="triangle" title="Triangle [1]">
          <span class="material-symbols-outlined">change_history</span>
        </button>
        </button>
        <button class="btnTool" tool="square" title="Square [2]">
          <span class="material-symbols-outlined">square</span>
        </button>
        <button class="btnTool" tool="circle" title="Circle [3]">
          <span class="material-symbols-outlined">circle</span>
        </button>
        <button class="btnTool" tool="diamond" title="Diamond [4]">
          <span class="material-symbols-outlined">diamond</span>
        </button>

        <br>

        <button class="btnTool" tool="letter" title="Letter [5]">
          <span class="material-symbols-outlined">abc</span>
        </button>
        <button class="btnTool" tool="number" title="Number [6]">
          <span class="material-symbols-outlined">123</span>
        </button>
        <button class="btnTool" tool="happy" title="Happy [7]">
          <span class="material-symbols-outlined">sentiment_satisfied</span>
        </button>
        <button class="btnTool" tool="sad" title="Sad [8]">
          <span class="material-symbols-outlined">sentiment_dissatisfied</span>
        </button>
        <button class="btnTool" tool="mark" title="Mark [9]">
          <span class="material-symbols-outlined">close</span>
        </button>
        <button id="clearAllMarkup" title="Remove all markup [SHIFT-X]">
          <span class="material-symbols-outlined">delete_sweep</span>
        </button>
      </div>

      <div class="block navigation">
        <div class="buttons">
          <button class="btnCommand" cmd="goToFirstPosition" title="Go to first position [cmd ←]">
            <span class="material-symbols-outlined">first_page</span>
          </button>
          <button class="btnCommand" cmd="goBackNumPositions" title="Go back 10 positions [shift ←]">
            <span class="material-symbols-outlined">replay_10</span>
          </button>
          <button class="btnCommand" cmd="goToPreviousPosition" title="Go back [←]">
            <span class="material-symbols-outlined">navigate_before</span>
          </button>

          <button id="startAutoPlay" title="Start auto play [space]">
            <span class="material-symbols-outlined">play_arrow</span>
          </button>
          <button id="stopAutoPlay" class="active" title="Stop auto play [space]">
            <span class="material-symbols-outlined">stop</span>
          </button>

          <button class="btnCommand" cmd="goToNextPosition" title="Go forward [→]">
            <span class="material-symbols-outlined">navigate_next</span>
          </button>
          <button class="btnCommand" cmd="goForwardNumPositions" title="Go forward 10 positions [shift →]">
            <span class="material-symbols-outlined">forward_10</span>
          </button>
          <button class="btnCommand" cmd="goToLastPosition" title="Go to last position [cmd →]">
            <span class="material-symbols-outlined">last_page</span>
          </button>

          <br>

          <button class="btnCommand" cmd="goToPreviousFork" title="Go to previous fork [alt ←]">
            <span class="material-symbols-outlined">fork_left</span>
          </button>
          <button class="btnCommand" cmd="goToNextFork" title="Go to next fork [alt →]">
            <span class="material-symbols-outlined">fork_right</span>
          </button>
          <button class="btnCommand" cmd="goToPreviousComment" title="Go to previous comment">
            <span class="material-symbols-outlined">comment</span>
          </button>
          <button class="btnCommand" cmd="goToNextComment" title="Go to next comment">
            <span class="material-symbols-outlined">chat</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="module">
import {
  Board,
  Player,
  constants,
  helpers
} from '../../src/index.js'
import {
  onClick,
  findByQuery,
  toggleHidden,
  toggleActive,
  setText
} from './js/demo.js'

//Audio
import audioMove from './audio/move.wav'
import audioCapture from './audio/capture.wav'

//Get constants
const {playerModes, editTools} = constants.player

//Set debug mode
helpers.util.setDebug(true)

//Find player element and instantiate player
const playerElement = document.getElementById('player')
const player = new Player({
  audio: {
    move: audioMove,
    capture: audioCapture,
  }
})

//Bootstrap player
player.bootstrap(playerElement)

//Settings
onClick('#settings', () => {
  toggleHidden('#settingsDropdown')
})

//Mode switching
onClick('.btnSwitchMode', btn => {
  const mode = btn.getAttribute('mode')
  player.setMode(mode)
})

//Commands
onClick('.btnCommand', btn => {
  const cmd = btn.getAttribute('cmd')
  player[cmd]()
})

//Edit tool selection
onClick('.btnTool', btn => {
  const tool = btn.getAttribute('tool')
  player.setMode(playerModes.EDIT)
  player.setEditTool(tool)
})

//Config toggles
onClick('.toggleConfig', lbl => {
  const key = lbl.getAttribute('config')
  const input = lbl.querySelector('input')
  player.toggleConfig(key, input.checked)
})

//Auto play
onClick('#startAutoPlay', () => {
  player.startAutoPlay()
})
onClick('#stopAutoPlay', () => {
  player.stopAutoPlay()
})

//Remove all markup
onClick('#clearAllMarkup', () => {
  player.setMode(playerModes.EDIT)
  player.clearAllMarkup()
})

//Handler for edit tool changes
const onEditToolChange = (event) => {
  const {tool} = event.detail

  //Toggle tool buttons
  findByQuery('.btnTool')
    .forEach(btn => {
      toggleActive(btn, btn.getAttribute('tool') === tool)
    })
}

//Set checkboxes to initial toggle value
findByQuery('.toggleConfig')
  .forEach(lbl => {
    const key = lbl.getAttribute('config')
    const input = lbl.querySelector('input')
    input.checked = player.getConfig(key)
  })

//Event handlers
player.on('modeChange', () => {
  toggleActive('#playMoves', player.isModeActive(playerModes.REPLAY))
})
player.on('editToolChange', onEditToolChange)
player.on('gameLoad', () => {
  player.setMode(playerModes.REPLAY)
  const {game} = player
  const black = game.getBlackPlayer()
  const white = game.getWhitePlayer()
  const komi = game.getKomi()
  const result = game.getInfo('game.result')
  const name = game.getInfo('game.name')
  const dates = game.getInfo('game.dates')
  const rules = game.getInfo('rules')
  const event = game.getInfo('event')
  const source = game.getInfo('source')
  setText('#playerBlackName', black.name || 'Black')
  setText('#playerWhiteName', white.name || 'White')
  setText('#playerBlackRank', black.rank || '')
  setText('#playerWhiteRank', white.rank || '')
  if (komi) {
    setText('#komi', `+${komi}`)
  }
  if (result) {
    toggleHidden('#gameInfo', false)
    toggleHidden('#resultRow', false)
    setText('#result', result)
  }
  if (name) {
    toggleHidden('#gameInfo', false)
    toggleHidden('#nameRow', false)
    setText('#name', name)
  }
  if (dates && dates.length > 0) {
    toggleHidden('#gameInfo', false)
    toggleHidden('#dateRow', false)
    setText('#date', dates[0])
  }
  if (rules.ruleSet) {
    toggleHidden('#gameInfo', false)
    toggleHidden('#rulesRow', false)
    setText('#rules', rules.ruleSet)
  }
  if (event) {
    const parts = [
      event.name,
      event.location,
      event.round
    ].filter(p => !!p)
    if (parts.length > 0) {
      toggleHidden('#gameInfo', false)
      toggleHidden('#eventRow', false)
      setText('#event', parts.join(', '))
    }
  }
})
player.on('autoPlayToggle', event => {
  const {isAutoPlaying} = event.detail
  toggleHidden('#startAutoPlay', isAutoPlaying)
  toggleHidden('#stopAutoPlay', !isAutoPlaying)
})

//Init
toggleHidden('#stopAutoPlay', true)
</script>
</body>
</html>
