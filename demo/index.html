<!DOCTYPE html>
<html>
<head>
  <title>Seki - Player demo</title>
  <meta charset="utf-8">
  <meta name="author" content="Adam Reis">
  <link rel="stylesheet" type="text/css" media="screen" href="../src/css/seki.css">
  <link rel="stylesheet" type="text/css" media="screen" href="demo.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>
<body lang="en">
<div class="main" id="app">
  <div class="left">
    <div id="player">
      <div id="board"></div>
    </div>
  </div>
  <div class="right">
    <h2>Load data</h2>
    <button id="loadBlank">Blank</button>
    <button id="loadJgf">JGF</button>
    <button id="loadSgf">SGF</button>
    <button id="loadGib">GIB</button>

    <h2>Switch mode</h2>
    <button id="switchModeNone">None</button>
    <button id="switchModeReplay">Replay</button>
    <button id="switchModePlay">Play</button>
    <button id="switchModeEdit">Edit</button>
    <!-- <button id="switchModeSolve">Solve</button> -->

    <div id="editTools">
      <h2>Markup</h2>
      <button id="switchMarkupToolCircle" class="icon">
        <span class="material-symbols-outlined">circle</span>
      </button>
      <button id="switchMarkupToolTriangle" class="icon">
        <span class="material-symbols-outlined">change_history</span>
      </button>
      <button id="switchMarkupToolSquare" class="icon">
        <span class="material-symbols-outlined">square</span>
      </button>
      <button id="switchMarkupToolDiamond" class="icon">
        <span class="material-symbols-outlined">diamond</span>
      </button>
      <button id="switchMarkupToolMark" class="icon">
        <span class="material-symbols-outlined">close</span>
      </button>
      <br>
      <button id="switchMarkupToolLetter" class="icon">
        <span class="material-symbols-outlined">hdr_auto</span>
      </button>
      <button id="switchMarkupToolNumber" class="icon">
        <span>1</span>
      </button>
      <button id="switchMarkupToolHappy" class="icon">
        <span class="material-symbols-outlined">sentiment_satisfied</span>
      </button>
      <button id="switchMarkupToolSad" class="icon">
        <span class="material-symbols-outlined">sentiment_dissatisfied</span>
      </button>
      <button id="switchMarkupToolClear" class="icon" title="Clear">
        <span class="material-symbols-outlined">ink_eraser</span>
      </button>

      <h2>Setup</h2>
      <button id="switchToolMove" class="icon" title="Move tool">
        <span class="material-symbols-outlined">fiber_smart_record</span>
      </button>
      <button id="switchSetupToolBlack" class="icon" title="Black stone">
        <span class="material-symbols-outlined">trip_origin</span>
      </button>
      <button id="switchSetupToolWhite" class="icon" title="White stone">
        <span class="material-symbols-outlined">fiber_manual_record</span>
      </button>
      <button id="switchSetupToolClear" class="icon" title="Clear">
        <span class="material-symbols-outlined">ink_eraser</span>
      </button>
    </div>

    <div id="replayTools">
      <h2>Navigate</h2>

      <button class="icon" id="firstMove" title="First move">
        <span class="material-symbols-outlined">line_start_arrow</span>
      </button>
      <button class="icon" id="skipBack" title="Skip back 10 moves">
        <span class="material-symbols-outlined">fast_rewind</span>
      </button>
      <button class="icon" id="prevMove" title="Previous move">
        <span class="material-symbols-outlined">skip_previous</span>
      </button>

      <button class="icon" id="startAutoPlay" title="Start auto play">
        <span class="material-symbols-outlined">play_arrow</span>
      </button>
      <button class="icon" id="stopAutoPlay" title="Stop auto play">
        <span class="material-symbols-outlined">stop</span>
      </button>

      <button class="icon" id="nextMove" title="Next move">
        <span class="material-symbols-outlined">skip_next</span>
      </button>
      <button class="icon" id="skipForward" title="Skip forward 10 moves">
        <span class="material-symbols-outlined">fast_forward</span>
      </button>
      <button class="icon" id="lastMove" title="Last move">
        <span class="material-symbols-outlined">line_end_arrow</span>
      </button>
    </div>

    <h2>Other</h2>
    <button id="toggleCoordinates">Toggle coordinates</button>
    <button id="toggleNextMove">Toggle next move</button>
    <button id="toggleVariations">Toggle variations</button>
    <button id="toggleSwapColors">Swap colors</button>
  </info>
</div>
<script type="module">
  import Board from '../src/classes/board.js'
  import Player from '../src/classes/player.js'
  import {setDebug} from '../src/helpers/util.js'
  import {bindClickHandler, toggleVisibility} from '../src/helpers/dom.js'
  import {playerModes, playerTools, markupTools, setupTools} from '../src/constants/player.js'

  //Test data
  import {jgf} from './data/jgf.js'
  import {gib} from './data/gib.js'
  import {sgf} from './data/sgf.js'

  //Set debug mode
  setDebug(true)

  //Find player element
  const playerElement = document.getElementById('player')

  //Instantiate player
  const player = new Player()

  //Bootstrap player and load JGF file
  player.bootstrap(playerElement)
  player.load(jgf)

  //Data loading
  bindClickHandler('loadJgf', () => {
    player.load(jgf)
    player.switchMode(playerModes.REPLAY)
  })
  bindClickHandler('loadSgf', () => {
    player.load(sgf)
    player.switchMode(playerModes.REPLAY)
  })
  bindClickHandler('loadGib', () => {
    player.load(gib)
    player.switchMode(playerModes.REPLAY)
  })
  bindClickHandler('loadBlank', () => {
    player.reset()
    player.switchMode(playerModes.PLAY)
  })

  //Toggles
  bindClickHandler('toggleNextMove', () => {
    player.toggleConfig('showNextMove')
    player.processPosition()
  })
  bindClickHandler('toggleVariations', () => {
    player.toggleConfig('showVariations')
    player.processPosition()
  })
  bindClickHandler('toggleCoordinates', () => player.board.toggleCoordinates())
  bindClickHandler('toggleSwapColors', () => player.board.toggleSwapColors())

  //Navigation
  bindClickHandler('firstMove', () => player.first())
  bindClickHandler('skipBack', () => player.skipBack())
  bindClickHandler('prevMove', () => player.previous())
  bindClickHandler('nextMove', () => player.next())
  bindClickHandler('skipForward', () => player.skipForward())
  bindClickHandler('lastMove', () => player.last())

  //Auto play
  bindClickHandler('startAutoPlay', () => {
    player.startAutoPlay()
    toggleVisibility('startAutoPlay', false)
    toggleVisibility('stopAutoPlay', true)
  })
  bindClickHandler('stopAutoPlay', () => {
    player.stopAutoPlay()
    toggleVisibility('stopAutoPlay', false)
    toggleVisibility('startAutoPlay', true)
  })

  //Mode switching
  bindClickHandler('switchModeNone', () => player.switchMode(playerModes.NONE))
  bindClickHandler('switchModeReplay', () => player.switchMode(playerModes.REPLAY))
  bindClickHandler('switchModePlay', () => player.switchMode(playerModes.PLAY))
  bindClickHandler('switchModeEdit', () => player.switchMode(playerModes.EDIT))
  bindClickHandler('switchModeSolve', () => player.switchMode(playerModes.SOLVE))

  //Markup tools
  bindClickHandler('switchMarkupToolCircle', () => {
    player.switchMarkupTool(markupTools.CIRCLE)
  })
  bindClickHandler('switchMarkupToolTriangle', () => {
    player.switchMarkupTool(markupTools.TRIANGLE)
  })
  bindClickHandler('switchMarkupToolSquare', () => {
    player.switchMarkupTool(markupTools.SQUARE)
  })
  bindClickHandler('switchMarkupToolDiamond', () => {
    player.switchMarkupTool(markupTools.DIAMOND)
  })
  bindClickHandler('switchMarkupToolMark', () => {
    player.switchMarkupTool(markupTools.MARK)
  })
  bindClickHandler('switchMarkupToolLetter', () => {
    player.switchMarkupTool(markupTools.LETTER)
  })
  bindClickHandler('switchMarkupToolNumber', () => {
    player.switchMarkupTool(markupTools.NUMBER)
  })
  bindClickHandler('switchMarkupToolHappy', () => {
    player.switchMarkupTool(markupTools.HAPPY)
  })
  bindClickHandler('switchMarkupToolSad', () => {
    player.switchMarkupTool(markupTools.SAD)
  })
  bindClickHandler('switchMarkupToolClear', () => {
    player.switchMarkupTool(markupTools.CLEAR)
  })

  //Setup tools
  bindClickHandler('switchToolMove', () => {
    player.switchTool(playerTools.MOVE)
  })
  bindClickHandler('switchSetupToolBlack', () => {
    player.switchSetupTool(setupTools.BLACK)
  })
  bindClickHandler('switchSetupToolWhite', () => {
    player.switchSetupTool(setupTools.WHITE)
  })
  bindClickHandler('switchSetupToolClear', () => {
    player.switchSetupTool(setupTools.CLEAR)
  })

  //Handler for mode changes
  const onModeChange = () => {
    const mode = player.getActiveMode()
    toggleVisibility('replayTools', mode === playerModes.REPLAY)
    toggleVisibility('editTools', mode === playerModes.EDIT)
  }

  //Event handlers
  player.on('modeChange', onModeChange)

  //Init
  onModeChange()
  toggleVisibility('stopAutoPlay', false)

</script>
</body>
</html>
